(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,676452,e=>{"use strict";e.s(["useHighlightsStore",()=>n]);var s=e.i(868275),t=e.i(486492),i=e.i(564448),r=e.i(364778),l=e.i(390418),o=e.i(605653);class a{constructor(e,l,o){var a=this;(0,s._)(this,"set",void 0),(0,s._)(this,"get",void 0),(0,s._)(this,"store",void 0),(0,s._)(this,"stories",void 0),(0,s._)(this,"isLoading",void 0),(0,s._)(this,"error",void 0),(0,s._)(this,"nextCursor",void 0),(0,s._)(this,"storyReactions",void 0),(0,s._)(this,"sourcePostsByStoryId",void 0),(0,s._)(this,"hasSeenAllStories",void 0),(0,s._)(this,"animatedStoryIds",void 0),(0,s._)(this,"setStories",void 0),(0,s._)(this,"setIsLoading",void 0),(0,s._)(this,"setError",void 0),(0,s._)(this,"setNextCursor",void 0),(0,s._)(this,"setStoryReaction",void 0),(0,s._)(this,"setSourcePostsByStoryId",void 0),(0,s._)(this,"getSourcePostsByStoryId",void 0),(0,s._)(this,"markStoryAnimated",void 0),(0,s._)(this,"hasStoryAnimated",void 0),(0,s._)(this,"likeStory",void 0),(0,s._)(this,"dislikeStory",void 0),(0,s._)(this,"fetchStories",void 0),(0,s._)(this,"fetchMoreStories",void 0),(0,s._)(this,"getStory",void 0),(0,s._)(this,"reset",void 0),this.set=e,this.get=l,this.store=o,this.stories=[],this.isLoading=!1,this.error=null,this.nextCursor=void 0,this.storyReactions={},this.sourcePostsByStoryId={},this.hasSeenAllStories=!1,this.animatedStoryIds=new Set,this.setStories=(0,i.assign)(this.set,"stories"),this.setIsLoading=(0,i.assign)(this.set,"isLoading"),this.setError=(0,i.assign)(this.set,"error"),this.setNextCursor=(0,i.assign)(this.set,"nextCursor"),this.setStoryReaction=(e,s)=>{this.set(t=>({storyReactions:{...t.storyReactions,[e]:s}}))},this.setSourcePostsByStoryId=(e,s)=>{this.set(t=>({sourcePostsByStoryId:{...t.sourcePostsByStoryId,[e]:s}}))},this.getSourcePostsByStoryId=e=>this.get().sourcePostsByStoryId[e],this.markStoryAnimated=e=>{let s=this.get();if(!s.animatedStoryIds.has(e)){let t=new Set(s.animatedStoryIds);t.add(e),this.set({animatedStoryIds:t})}},this.hasStoryAnimated=e=>this.get().animatedStoryIds.has(e),this.likeStory=e=>{let s=this.get().storyReactions[e];this.setStoryReaction(e,"liked"===s?null:"liked")},this.dislikeStory=e=>{let s=this.get().storyReactions[e];this.setStoryReaction(e,"disliked"===s?null:"disliked")},this.fetchStories=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:10;return a.setIsLoading(!0),a.setError(null),r.highlightsApi.highlightsGetStories({limit:e}).then(e=>{let s=a.get(),t=e.stories||[],i=new Set(s.stories.map(e=>e.storyId)),r=t.filter(e=>!i.has(e.storyId));a.set({stories:[...r,...s.stories],nextCursor:e.nextCursor,hasSeenAllStories:0===r.length,isLoading:!1})}).catch(e=>{let s=e instanceof Error?e:Error("Failed to fetch highlights");a.set({error:s,isLoading:!1}),(0,t.logError)("highlights-store:fetchStories",e)})},this.fetchMoreStories=()=>{let e=this.get();return e.isLoading||!e.nextCursor?Promise.resolve():(this.setIsLoading(!0),this.setError(null),r.highlightsApi.highlightsGetStories({limit:10,cursor:e.nextCursor}).then(s=>{let t=s.stories||[],i=new Set(e.stories.map(e=>e.storyId)),r=t.filter(e=>!i.has(e.storyId));this.set({stories:[...e.stories,...r],nextCursor:s.nextCursor,hasSeenAllStories:0===r.length,isLoading:!1})}).catch(e=>{let s=e instanceof Error?e:Error("Failed to load more highlights");this.set({error:s,isLoading:!1}),(0,t.logError)("highlights-store:loadMore",e)}))},this.getStory=(e,s)=>{let i=this.get().stories.find(s=>s.storyId===e);return i?Promise.resolve(i):r.highlightsApi.highlightsGetStory({storyId:e,source:s}).then(e=>{let s=e.story;if(!s)throw Error("Story not found");return this.set(e=>({stories:e.stories.some(e=>e.storyId===s.storyId)?e.stories:[...e.stories,s]})),s}).catch(e=>{throw(0,t.logError)("highlights-store:getStory",e),e})},this.reset=()=>{this.set({stories:[],isLoading:!1,error:null,nextCursor:void 0,sourcePostsByStoryId:{}})}}}let n=(0,l.create)()((0,o.devtools)((0,o.persist)((e,s,t)=>new a(e,s,t),{name:"highlights-storage",partialize:e=>({storyReactions:e.storyReactions})}),{name:"useHighlightsStore"}))},398459,112089,e=>{"use strict";e.s(["HighlightsSection",()=>E,"HighlightsStoryRow",()=>A],398459);var s=e.i(953563),t=e.i(824027),i=e.i(981176);e.i(685846);var r=e.i(415860),l=e.i(296451),o=e.i(19945),a=e.i(883440),n=e.i(946032),h=e.i(235289);e.i(916390);var c=e.i(572848),d=e.i(763578),u=e.i(410289),g=e.i(723008),m=e.i(50636),x=e.i(920958),y=e.i(486492),f=e.i(165275),p=e.i(724499),v=e.i(211959),S=e.i(555309),I=e.i(619587);e.i(18545);var j=e.i(116212),N=e.i(713216),w=e.i(676452);e.s(["useEngagingPosts",()=>L,"useLoadDiscussionPosts",()=>H,"useSourcePosts",()=>C],112089);var b=e.i(364778);e.i(298616);var k=e.i(111669),_=e.i(910503);function C(e,s){let t=(0,w.useHighlightsStore)();return(0,_.useQuery)({queryKey:["highlights","source-posts",e,s],queryFn:async()=>{var i,r;if(!e)return[];let l=(null==(r=(await b.highlightsApi.highlightsGetSourcePosts({body:{storyIds:[e],source:s}})).storyPosts)||null==(i=r[0])?void 0:i.posts)||[];return t.setSourcePostsByStoryId(e,l),l},enabled:!!e,staleTime:3e5,gcTime:6e5,initialData:()=>e?t.getSourcePostsByStoryId(e):[]})}function L(e,s){return(0,_.useQuery)({queryKey:["highlights","engaging-posts",e,s],queryFn:async()=>e&&(await b.highlightsApi.highlightsGetEngagingPosts({storyId:e,source:s})).engagingPosts||[],enabled:!!e,staleTime:3e5,gcTime:6e5})}function H(e,s){var t;let i=(0,k.useInfiniteQuery)({queryKey:["highlights","discussion-posts",e,s],queryFn:async t=>{let{pageParam:i}=t;if(!e)throw Error("Story ID is required");let r=await b.highlightsApi.highlightsGetDiscussionPosts({storyId:e,limit:20,cursor:i,source:s});return{discussionPosts:r.discussionPosts||[],nextCursor:r.nextCursor||void 0}},initialPageParam:void 0,getNextPageParam:e=>e.nextCursor,enabled:!!e,staleTime:3e5,gcTime:6e5});return{discussionPosts:(null==(t=i.data)?void 0:t.pages.flatMap(e=>e.discussionPosts))||[],isLoading:i.isLoading,error:i.error,hasMore:i.hasNextPage,loadMore:i.fetchNextPage,isFetchingNextPage:i.isFetchingNextPage}}function A(e){var t,i,h,g,N,b,k,_,L;let{story:H,onClick:A,borderless:E,mode:T="embedded"}=e,[P,M]=(0,I.useState)(!1),R=(0,x.useLogEvent)(),{t:B}=(0,j.useTranslation)("chat"),{user:z}=(0,c.useSession)(),D=(0,w.useHighlightsStore)(e=>e.storyReactions),G=(0,m.useFeatureFlags)(),{data:F=[],isLoading:U}=C(H.storyId,H.source),O=(0,I.useMemo)(()=>F.filter(e=>{var s;return(null==(s=e.entities)?void 0:s.media)&&e.entities.media.length>0}).sort((e,s)=>{var t,i;return((null==(t=s.publicMetrics)?void 0:t.likeCount)||0)-((null==(i=e.publicMetrics)?void 0:i.likeCount)||0)})[0]||F[0],[F]),X=null==O||null==(h=O.entities)||null==(i=h.media)||null==(t=i[0])?void 0:t.url,W=(null==O||null==(b=O.entities)||null==(N=b.media)||null==(g=N[0])?void 0:g.previewImageUrl)||X,Q=W&&!P,q=D[H.storyId||""],V=(0,I.useMemo)(()=>{if(U||0===F.length)return;let e=F.reduce((e,s)=>Math.max(e,new Date(s.createTime||0).getTime()),0),s=Math.floor((Date.now()-e)/6e4);return 0===s?B("highlights-less-than-minute-ago","<1 minute ago"):s<60?B("highlights-minutes-ago","{{count}} minutes ago",{count:s}):B("highlights-hours-ago","{{count}} hours ago",{count:Math.floor(s/60)})},[F,B,U]),K=(0,I.useMemo)(()=>F.reduce((e,s)=>{var t;return e+((null==(t=s.publicMetrics)?void 0:t.viewCount)||s.viewCount||0)},0),[F]),Y=(0,I.useMemo)(()=>F.reduce((e,s)=>{var t;return e+((null==(t=s.publicMetrics)?void 0:t.likeCount)||0)},0),[F]),J=(0,I.useMemo)(()=>{let e=new Map;return F.forEach(s=>{if(s.username){var t;let i=(null==(t=s.publicMetrics)?void 0:t.likeCount)||0,r=e.get(s.username);r?i>r.maxLikeCount&&(r.maxLikeCount=i,r.postId=s.postId,!r.verifiedType&&s.verifiedType&&(r.verifiedType=s.verifiedType)):e.set(s.username,{name:s.name||"",username:s.username||"",profileImageUrl:s.profileImageUrl,verifiedType:s.verifiedType,maxLikeCount:i,postId:s.postId})}}),Array.from(e.values()).sort((e,s)=>s.maxLikeCount-e.maxLikeCount)},[F]),Z=(0,I.useCallback)(e=>{if(!H.storyId)return void(0,y.logError)("highlights-story-card:HighlightsStoryRow:handleClick","storyId is undefined",{story:JSON.stringify(H)});R("highlights_story_tapped",H.storyId,{location:"highlights-story-card:HighlightsStoryRow:click",storyId:H.storyId,title:H.title||""}),e.metaKey||e.ctrlKey||(e.preventDefault(),A(H.storyId))},[H,R,A]),$=(0,I.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!H.storyId)return;let s=w.useHighlightsStore.getState();R("highlight_story_liked",H.storyId,{location:"highlights-story-card:HighlightsStoryRow:handleLike",storyId:H.storyId,title:H.title||"",wasAlreadyLiked:String("liked"===q)}),s.likeStory(H.storyId)},[H.storyId,H.title,q,R]),ee=(0,I.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!H.storyId)return;let s=w.useHighlightsStore.getState();R("highlight_story_disliked",H.storyId,{location:"highlights-story-card:HighlightsStoryRow:handleDislike",storyId:H.storyId,title:H.title||"",wasAlreadyDisliked:String("disliked"===q)}),s.dislikeStory(H.storyId)},[H.storyId,H.title,q,R]),es=(0,I.useMemo)(()=>J.slice(0,3),[J]),et="minimal"===T,ei="HIGHLIGHTS_SOURCE_PHOENIX"===H.source,er=G.HIGHLIGHTS_ONLY_TEXT,el=(null==z||null==(k=z.email)?void 0:k.endsWith("@x.ai"))||(null==z||null==(_=z.email)?void 0:_.endsWith("@teachx.ai")),eo=ei&&el;return(0,s.jsx)(p.Link,{route:ei?{page:"trends",storyId:H.storyId}:{page:"highlights",storyId:H.storyId},className:(0,v.cn)("w-full",et?["flex rounded-xl hover:bg-surface-l1-hover","group cursor-pointer relative","p-3"]:["grid gap-y-2 gap-x-4",er?"grid-cols-[1fr] grid-rows-[auto]":Q?"grid-cols-[1fr_fit-content(200px)] grid-rows-[auto_24px]":"grid-cols-[1fr] grid-rows-[auto_24px]","overflow-hidden",E?"bg-transparent rounded-2xl":"border rounded-3xl bg-surface-l1","hover:bg-surface-l4-hover dark:hover:bg-surface-l2","ps-4 pe-3 py-3",!er&&"min-h-[90px]","text-start"]),onClick:Z,children:(0,s.jsx)(S.motion.div,{className:"flex gap-4 flex-1",layout:G.ENABLE_HIGHLIGHTS_ANIMATION,initial:!1,animate:{height:"auto"},transition:{duration:.1,ease:"easeOut"},children:et?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col justify-between flex-1 min-w-0 ps-1 py-1",children:[(0,s.jsxs)("div",{className:"space-y-1",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsx)("h3",{className:"text-primary font-semibold line-clamp-2 leading-tight m-0",children:H.title}),er&&eo&&(0,s.jsx)(n.XLogoIcon,{className:"size-3.5 text-secondary shrink-0 mt-0.5"})]}),H.summary&&G.ENABLE_HIGHLIGHTS_ANIMATION&&(0,s.jsx)("div",{className:(0,v.cn)("mt-2 text-secondary text-sm line-clamp-2 opacity-0 group-hover:opacity-100 transition-opacity"),children:H.summary})]}),!er&&(0,s.jsxs)("div",{className:"flex flex-row gap-2 items-center mt-2",children:[V&&(0,s.jsx)("div",{className:"text-secondary text-sm",children:V}),(0,s.jsx)("div",{className:(0,v.cn)("opacity-0 group-hover:opacity-100",G.ENABLE_HIGHLIGHTS_ANIMATION&&"transition-opacity"),children:(0,s.jsxs)("div",{className:"flex flex-row items-center gap-1",children:[(0,s.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:$,className:(0,v.cn)("liked"===q&&"text-primary"),"aria-label":"Like this story",children:(0,s.jsx)(a.ThumbsUpIcon,{className:"size-4"})}),(0,s.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:ee,className:(0,v.cn)("disliked"===q&&"text-primary"),"aria-label":"Dislike this story",children:(0,s.jsx)(o.ThumbsDownIcon,{className:"size-4"})}),eo&&(0,s.jsx)(n.XLogoIcon,{className:"size-3.5 text-secondary"})]})})]})]}),!er&&(U||Q)&&(0,s.jsx)("div",{className:"shrink-0 w-[128px] h-[96px] rounded-xl overflow-hidden",children:U?(0,s.jsx)(u.Skeleton,{className:"w-full h-full"}):(0,s.jsx)("img",{src:W,alt:H.title||B("highlights-story-media","Story media"),className:"w-full h-full object-cover",onError:()=>M(!0)})})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"flex flex-col gap-1.5 overflow-hidden col-span-1 row-span-1",children:[(0,s.jsxs)("div",{className:"flex items-start justify-between gap-2",children:[(0,s.jsx)("h3",{className:"text-primary font-semibold text-lg line-clamp-2 leading-tight m-0",children:H.title}),er&&eo&&(0,s.jsx)(n.XLogoIcon,{className:"size-3.5 text-secondary shrink-0 mt-1"})]}),!er&&("authors"===T?(0,s.jsxs)(s.Fragment,{children:[H.summary&&(0,s.jsx)("p",{className:"text-secondary text-sm line-clamp-2 leading-snug m-0 mt-1",children:H.summary}),(0,s.jsxs)("div",{className:"flex items-center gap-2 mt-auto overflow-hidden",children:[(0,s.jsx)("div",{className:"flex gap-1.5 flex-nowrap overflow-hidden flex-shrink min-w-0",children:es.map((e,t)=>(e.name,e.username,e.profileImageUrl,e.verifiedType,e.verifiedType,(0,s.jsxs)("div",{className:(0,v.cn)("flex items-center gap-1.5","ps-1 pe-2 py-1 rounded-full","bg-surface-l2 hover:bg-surface-l3","border border-border-l1","cursor-pointer transition-all","flex-shrink-0"),onClick:s=>{s.stopPropagation(),s.preventDefault(),e.postId&&(R("highlight_author_pill_clicked",e.postId,{location:"highlights-story-card:HighlightsStoryRow:authorPill",storyId:H.storyId||"",username:e.username,postId:e.postId}),window.open("https://x.com/".concat(e.username,"/status/").concat(e.postId),"_blank"))},children:[(0,s.jsx)("div",{className:"relative size-5 rounded-full bg-surface-l3 overflow-hidden flex-shrink-0",children:e.profileImageUrl?(0,s.jsx)("img",{src:e.profileImageUrl,alt:e.name,className:"w-full h-full object-cover"}):(0,s.jsx)("div",{className:(0,v.cn)("w-full h-full flex items-center justify-center","bg-gradient-to-br from-purple-500/30 via-blue-500/30 to-pink-500/30","text-primary text-[10px] font-medium"),children:e.name.charAt(0).toUpperCase()})}),(0,s.jsxs)("span",{className:"text-xs text-primary font-medium",children:["@",e.username]})]},e.username)))}),J.length>es.length&&(0,s.jsx)("div",{className:(0,v.cn)("flex items-center gap-1.5 flex-shrink-0"),children:(0,s.jsxs)("span",{className:"text-xs text-secondary font-medium whitespace-nowrap",children:["+",B("highlights-more-authors",{defaultValue_one:"{{count}} more",defaultValue_other:"{{count}} more",count:J.length-es.length})]})})]})]}):(0,s.jsxs)(s.Fragment,{children:[J.length>0&&(0,s.jsxs)("div",{className:"flex items-center gap-1 text-secondary text-sm mt-1",children:[(0,s.jsxs)("span",{children:["@",null==(L=J[0])?void 0:L.username]}),J.length>1&&(0,s.jsxs)("span",{className:"text-xs",children:["+",B("highlights-more-authors",{defaultValue_one:"{{count}} more",defaultValue_other:"{{count}} more",count:J.length-1})]})]}),H.summary&&(0,s.jsx)("p",{className:"text-secondary text-sm line-clamp-2 leading-snug m-0",children:H.summary})]}))]}),!er&&Q&&(0,s.jsx)("div",{className:"col-span-1 row-span-2 flex items-center justify-end",children:(0,s.jsx)("div",{className:"relative w-[200px] h-full max-h-[200px] rounded-xl overflow-hidden bg-surface-l2",children:(0,s.jsx)("img",{src:W,alt:H.title||B("highlights-story-media","Story media"),className:"w-full h-full object-cover",onError:()=>M(!0)})})}),!er&&(0,s.jsxs)("div",{className:"flex items-center h-min gap-4 text-secondary self-end text-xs col-span-1 row-span-1",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:$,className:(0,v.cn)("liked"===q&&"text-primary"),"aria-label":"Like this story",children:(0,s.jsx)(a.ThumbsUpIcon,{className:"size-4"})}),(0,s.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:ee,className:(0,v.cn)("disliked"===q&&"text-primary"),"aria-label":"Dislike this story",children:(0,s.jsx)(o.ThumbsDownIcon,{className:"size-4"})}),eo&&(0,s.jsx)(n.XLogoIcon,{className:"size-3.5 text-secondary"})]}),K>0&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(r.ChartBar,{className:"size-4 scale-x-[-1] rotate-90"}),(0,s.jsx)("span",{children:(0,f.formatNumber)(K)})]}),Y>0&&(0,s.jsxs)("div",{className:"flex items-center gap-1",children:[(0,s.jsx)(l.HeartIcon,{className:"size-4"}),(0,s.jsx)("span",{children:(0,f.formatNumber)(Y)})]}),(0,s.jsx)("span",{children:V})]})]})})})}function E(e){let{className:r,story:l}=e,{t:n}=(0,j.useTranslation)("chat"),c=(0,x.useLogEvent)(),m=(0,I.useRef)(null),p=(0,I.useRef)(!1),S=(0,w.useHighlightsStore)(e=>e.storyReactions),{discussionPosts:b,isLoading:k,hasMore:_,loadMore:A}=H(l.storyId,l.source),E=(0,I.useRef)(null),T=S[l.storyId||""],{data:P=[],isLoading:M}=C(l.storyId,l.source),{data:R=[]}=L(l.storyId,l.source),B=(0,I.useMemo)(()=>[...P].sort((e,s)=>{var t,i;return((null==(t=s.publicMetrics)?void 0:t.likeCount)||0)-((null==(i=e.publicMetrics)?void 0:i.likeCount)||0)}),[P]),z=(0,I.useRef)(null),[D,G]=(0,I.useState)(!0),[F,U]=(0,I.useState)(!1),[O,X]=(0,I.useState)(!1);(0,I.useEffect)(()=>{z.current&&B.length>0&&U(z.current.scrollHeight>392)},[B]);let W=(0,I.useMemo)(()=>{if(M||0===P.length)return;let e=P.reduce((e,s)=>Math.max(e,new Date(s.createTime||0).getTime()),0),s=Math.floor((Date.now()-e)/6e4);return 0===s?n("highlights-less-than-minute-ago","<1 minute ago"):s<60?n("highlights-minutes-ago","{{count}} minutes ago",{count:s}):n("highlights-hours-ago","{{count}} hours ago",{count:Math.floor(s/60)})},[P,M,n]),Q=(0,I.useMemo)(()=>{let e=new Set(P.map(e=>e.postId).filter(Boolean));return R.filter(s=>!e.has(s.postId))},[R,P]),q=(0,I.useMemo)(()=>{let e=[...Q,...b],s=new Set;return e.filter(e=>!(!e.postId||s.has(e.postId))&&(s.add(e.postId),!0))},[Q,b]),V=(0,I.useCallback)(e=>{E.current&&E.current.disconnect(),e&&(E.current=new IntersectionObserver(e=>{let[s]=e;s&&s.isIntersecting&&_&&!k&&A().catch((0,y.createLogError)("highlights-story-card:loadMoreDiscussionPosts"))},{threshold:.1,rootMargin:"0px 0px 200px 0px"}),E.current.observe(e))},[_,k,A]);(0,I.useEffect)(()=>()=>{E.current&&E.current.disconnect()},[]);let K=(0,I.useMemo)(()=>{let e=[];return P.forEach(s=>{var t,i;let r=(null==(t=s.entities)?void 0:t.media)||[],l=[];if(r.forEach(e=>{let s=e.url||e.previewImageUrl;s&&l.push(s)}),l.length>0){let t=(null==(i=s.publicMetrics)?void 0:i.likeCount)||0;e.push({post:s,images:l,likeCount:t})}}),e.sort((e,s)=>s.likeCount-e.likeCount).flatMap(e=>e.images)},[P])[0];(0,I.useEffect)(()=>{X(!1)},[K]);let Y=(0,I.useMemo)(()=>P.reduce((e,s)=>{var t;return e+((null==(t=s.publicMetrics)?void 0:t.viewCount)||s.viewCount||0)},0),[P]);(0,I.useEffect)(()=>{let e=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&!p.current&&(p.current=!0,c("highlights_story_impression",l.storyId||"",{location:"highlights-section:HighlightsSection:impression",storyId:l.storyId||"",title:l.title||""}))})},{threshold:0});return m.current&&e.observe(m.current),()=>{e.disconnect()}},[l.storyId,l.title,c]);let J=(0,I.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!l.storyId)return;let s=w.useHighlightsStore.getState();c("highlight_story_liked",l.storyId,{location:"highlights-section:HighlightsSection:handleLike",storyId:l.storyId,title:l.title||"",wasAlreadyLiked:String("liked"===T)}),s.likeStory(l.storyId)},[l.storyId,l.title,T,c]),Z=(0,I.useCallback)(e=>{if(e.stopPropagation(),e.preventDefault(),!l.storyId)return;let s=w.useHighlightsStore.getState();c("highlight_story_disliked",l.storyId,{location:"highlights-section:HighlightsSection:handleDislike",storyId:l.storyId,title:l.title||"",wasAlreadyDisliked:String("disliked"===T)}),s.dislikeStory(l.storyId)},[l.storyId,l.title,T,c]),$=(0,I.useCallback)(e=>{c("highlights_post_link_clicked",e,{location:"highlights-section:HighlightsSection:handlePostClick",storyId:l.storyId||"",postId:e})},[l.storyId,c]);return(0,s.jsxs)("section",{ref:m,id:l.storyId||void 0,className:(0,v.cn)("w-full scroll-mt-4",h.QUERY_BAR_MAX_WIDTH_CLASS,r),children:[(M||K)&&(0,s.jsxs)("div",{className:"relative w-full mb-6 rounded-2xl overflow-hidden",children:[M||!O?(0,s.jsx)(u.Skeleton,{className:"w-full aspect-video"}):null,K&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:K,alt:"","aria-hidden":"true",className:(0,v.cn)("absolute inset-0 w-full h-full object-cover blur-3xl scale-110 opacity-60",!O&&"invisible")}),(0,s.jsx)("img",{src:K,alt:l.title||n("highlights-story-image","Story image"),className:(0,v.cn)("relative w-full h-auto max-h-[500px] object-contain",!O&&"invisible absolute"),onLoad:()=>X(!0)})]})]}),(0,s.jsx)("h2",{className:"text-primary font-semibold text-2xl mb-2 m-0",children:l.title}),Q.length>0&&(0,s.jsx)("div",{className:"mb-4 space-y-3",children:l.summary&&(0,s.jsx)("p",{className:"text-secondary text-base mb-4 m-0",children:l.summary})}),!Q.length&&l.summary&&(0,s.jsx)("p",{className:"text-secondary text-base mb-4 m-0",children:l.summary}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:J,className:(0,v.cn)("liked"===T&&"text-primary"),"aria-label":n("highlights-like-story","Like this story"),children:(0,s.jsx)(a.ThumbsUpIcon,{className:"size-4"})}),(0,s.jsx)(d.Button,{variant:"ghostSecondary",size:"iconXs",rounded:!0,onClick:Z,className:(0,v.cn)("disliked"===T&&"text-primary"),"aria-label":n("highlights-dislike-story","Dislike this story"),children:(0,s.jsx)(o.ThumbsDownIcon,{className:"size-4"})})]}),(0,s.jsxs)("div",{className:"flex items-center gap-1 text-secondary text-sm",children:[Y>0&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{children:n("highlights-views",{count:Y,formattedCount:(0,f.formatNumber)(Y),defaultValue_one:"{{formattedCount}} view",defaultValue_other:"{{formattedCount}} views"})}),(0,s.jsx)("span",{children:"Â·"})]}),W&&(0,s.jsx)("span",{children:W})]})]}),B.length>0&&(0,s.jsxs)("div",{className:(0,v.cn)("mb-8",D&&F&&"max-h-96 overflow-hidden relative"),ref:z,children:[(0,s.jsx)("div",{className:"flex flex-col overflow-hidden",children:B.map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsx)("div",{onClick:()=>{D?G(!1):$(e.postId||"unknown")},className:(0,v.cn)(D&&"cursor-pointer"),children:(0,s.jsx)(i.XPostConversationCard,{xPost:e,wide:!0,mode:"inline",showStats:{replies:!0,reposts:!0,likes:!0,views:!0},showMedia:!0,disabled:D})}),t<B.length-1&&(0,s.jsx)("div",{className:"h-px bg-border-l1 mx-4"})]},e.postId||t))}),D&&F&&(0,s.jsx)("div",{className:"absolute bottom-0 left-0 right-0 h-12 bg-gradient-to-t from-surface-base to-transparent flex items-end justify-center pb-2",children:(0,s.jsx)(d.Button,{variant:"secondary",size:"sm",onClick:()=>G(!1),children:n("highlights.show-more","Show more")})})]}),l.grokAnalysis&&(0,s.jsx)("div",{className:"mb-8",children:(0,s.jsx)(N.MessageBubble,{isUser:!1,children:(0,s.jsx)(t.MemoizedMarkdown,{sender:"assistant",shouldRenderHtml:!0,children:l.grokAnalysis})})}),q.length>0&&(0,s.jsxs)("div",{className:"mb-8",children:[(0,s.jsx)("h3",{className:"text-primary font-semibold text-lg mb-4",children:n("highlights-what-the-world-is-saying","What the world is saying")}),(0,s.jsxs)("div",{className:"flex flex-col overflow-hidden",children:[q.map((e,t)=>(0,s.jsxs)("div",{children:[(0,s.jsx)(i.XPostConversationCard,{xPost:e,wide:!0,mode:"inline",showStats:{replies:!0,reposts:!0,likes:!0,views:!0},showMedia:!0}),t<q.length-1&&(0,s.jsx)("div",{className:"h-px bg-border-l1 mx-4"})]},e.postId||"discussion-".concat(t))),(0,s.jsx)("div",{ref:V,className:"w-full h-1"}),k&&(0,s.jsx)("div",{className:"flex items-center justify-center py-4",children:(0,s.jsx)(g.Spinner,{size:"sm"})})]})]})]})}},796066,e=>{"use strict";e.s(["useLoadHighlights",()=>l]);var s=e.i(619587),t=e.i(572848),i=e.i(676452),r=e.i(50636);function l(){let e=(0,t.useSession)().user,l=(0,r.useFeatureFlags)(),o=(0,i.useHighlightsStore)(e=>e.isLoading),a=(0,i.useHighlightsStore)(e=>e.error);return(0,s.useEffect)(()=>{if(!l.ALLOW_HIGHLIGHTS_ACCESS_WEB)return;let s=i.useHighlightsStore.getState();s.stories.length>=10||e&&!s.isLoading&&s.fetchStories(10).catch(e=>{})},[e,l.ALLOW_HIGHLIGHTS_ACCESS_WEB]),{isLoading:o,error:a}}},829735,844858,e=>{"use strict";e.s(["HighlightsAllStoriesPage",()=>z,"default",()=>B],829735);var s=e.i(953563),t=e.i(619587);e.i(18545);var i=e.i(116212),r=e.i(211959),l=e.i(486492),o=e.i(920958),a=e.i(235289),n=e.i(676452),h=e.i(796066),c=e.i(398459),d=e.i(724499),u=e.i(258722);e.i(685846);var g=e.i(680491),m=e.i(763578),x=e.i(380619),y=e.i(246429),f=e.i(389052),p=e.i(892621);e.s(["ArrowLeft",()=>v.default],844858);var v=e.i(935622),v=v,S=e.i(383293),I=e.i(383274),j=e.i(572848),N=e.i(443696),w=e.i(410289),b=e.i(713087),k=e.i(50636),_=e.i(328788),C=e.i(243634),L=e.i(157695),H=e.i(230433),A=e.i(805546),E=e.i(470753),T=e.i(180473),P=e.i(112089);function M(){let{t:e}=(0,i.useTranslation)("chat"),h=(0,T.useParams)(),{route:g}=(0,d.useRouting)(),m=("highlights"===g.page||"trends"===g.page)&&g.storyId||(null==h?void 0:h.id),M="trends"===g.page?"HIGHLIGHTS_SOURCE_PHOENIX":"HIGHLIGHTS_SOURCE_HIGHLIGHTS",R=(0,o.useLogEvent)(),{user:B}=(0,j.useSession)(),z=(0,I.useMaybeRefreshAnonSession)(),{signInWithReturnTo:D}=(0,b.useGrokRouter)(),G=(0,C.useForceSignInModels)(),F=(0,k.useFeatureFlags)(),U=(0,E.useSettingsStore)(e=>e.isIncognito),O=(0,_.useMobileSize)(),{bestSubscription:X}=(0,H.useSubscriptions)(),W=(0,A.useIsFirstTimeUser)(),Q=(0,n.useHighlightsStore)(e=>e.getStory),q=(0,t.useMemo)(()=>m?Q(m,M):void 0,[Q,m,M]),{data:V,isUninitialized:K,isLoading:Y,error:J}=(0,L.usePromise)(q),{data:Z=[]}=(0,P.useSourcePosts)(m,M),{data:$=[]}=(0,P.useEngagingPosts)(m,M),{sessionStartTime:ee,conversationDepth:es}=(0,p.useTimeToValueAnalytics)();(0,t.useEffect)(()=>{V&&R("highlight_story_page_view",m,{location:"highlight-story-page",storyId:m,title:V.title||""})},[V,m,R]);let et=(0,t.useCallback)(e=>{let{query:s,fileAttachmentIds:t,toolOverrides:i,workspaceIds:r,persona:o,isIncognitoOverride:a,disableMemory:n,modelIdOverride:h}=e;if(!s||!s.trim())return Promise.resolve(!1);let c=y.useChatPageStore.getState(),d=E.useSettingsStore.getState(),g=u.useRoutingStore.getState();return!B&&G.includes(c.activeModelId)?(R("sign_in","highlight-story-page",{location:"highlight-story-page:handleSend"}),D(s),Promise.resolve(!1)):z().then(()=>{let e=(0,f.toAnalytics)({activeModelId:h||c.activeModelId,modelMode:h?"":void 0,query:s,fileAttachmentIds:t,location:"highlight-story-page",personalityId:d.userSettings.preferences.selectedSystemPromptId||"",personaId:"",sessionStartTime:ee,conversationDepth:es,isMobile:O,bestSubscription:X,user:!!B,workspaceCount:(null==r?void 0:r.length)||0,toolOverrides:i,parentResponseId:"",isFirstTimeUser:W}),u=Z.map(e=>e.postId),m=$.slice(0,2).map(e=>"@".concat(e.username,": ").concat(e.text)),x=[(null==V?void 0:V.title)&&"Story: ".concat(V.title),m&&m.length>0&&"Popular responses: ".concat(m.join(" | ")),!(null==m?void 0:m.length)&&(null==V?void 0:V.summary)&&"Summary: ".concat(V.summary),u&&"X posts: ".concat(u.join(", ")),s].filter(Boolean).join("\n\n");R("send_query","",e);let y=null!=a?a:U;return c.establishNewConversation({message:x,fileAttachmentIds:t,toolOverrides:i,temporary:y,enableRetries:!0,ff:F,persona:o,disableMemory:n,onOptimisticConversation:()=>{g.push({page:"main"})}}).catch((0,l.createLogError)("highlight-story-page:establishNewConversation")).then(e=>!!e)})},[B,G,z,R,D,ee,es,O,X,W,Z,$,null==V?void 0:V.title,null==V?void 0:V.summary,U,F]),ei=(0,t.useCallback)(()=>{(0,u.useRoutingStore.getState().push)({page:"main"})},[]);return K||Y?(0,s.jsx)("div",{className:(0,r.cn)("flex flex-col items-center w-full h-[100vh]",x.CHAT_CONTAINER_CLASSES),children:(0,s.jsx)("div",{className:"flex-1 w-full overflow-y-auto",children:(0,s.jsxs)("div",{className:(0,r.cn)("w-full",a.QUERY_BAR_MAX_WIDTH_CLASS,"mx-auto px-4"),children:[(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)(N.Button,{variant:"tertiary",size:"md",shape:"circle",onClick:ei,className:"shrink-0","aria-label":e("highlights-detail-page.back","Back"),children:(0,s.jsx)(v.default,{size:20})})}),(0,s.jsxs)("div",{className:"pt-3",children:[(0,s.jsx)(w.Skeleton,{className:"w-full aspect-video rounded-2xl mb-6"}),(0,s.jsx)(w.Skeleton,{className:"h-8 w-4/5 mb-2"}),(0,s.jsxs)("div",{className:"space-y-1.5 mb-4",children:[(0,s.jsx)(w.Skeleton,{className:"h-5 w-full"}),(0,s.jsx)(w.Skeleton,{className:"h-5 w-3/4"})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between mb-6",children:[(0,s.jsxs)("div",{className:"flex items-center gap-2",children:[(0,s.jsx)(w.Skeleton,{className:"size-8 rounded-full"}),(0,s.jsx)(w.Skeleton,{className:"size-8 rounded-full"})]}),(0,s.jsx)(w.Skeleton,{className:"h-4 w-32"})]}),(0,s.jsxs)("div",{className:"space-y-4",children:[(0,s.jsx)(w.Skeleton,{className:"w-full h-32 rounded-xl"}),(0,s.jsx)(w.Skeleton,{className:"w-full h-32 rounded-xl"})]})]})]})})}):J||!V?(0,s.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,s.jsx)("div",{className:(0,r.cn)("w-full",a.QUERY_BAR_MAX_WIDTH_CLASS),children:(0,s.jsx)("p",{className:"text-secondary text-center",children:e("highlight-not-found","Highlight story not found.")})})}):(0,s.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center w-full h-[100vh]",x.CHAT_CONTAINER_CLASSES),children:[(0,s.jsx)("div",{className:"flex-1 w-full overflow-y-auto",children:(0,s.jsxs)("div",{className:(0,r.cn)("w-full",a.QUERY_BAR_MAX_WIDTH_CLASS,"mx-auto px-4 relative"),children:[(0,s.jsx)("div",{className:"mt-3",children:(0,s.jsx)(N.Button,{variant:"tertiary",size:"md",shape:"circle",onClick:ei,className:"shrink-0","aria-label":e("highlights-detail-page.back","Back"),children:(0,s.jsx)(v.default,{size:20})})}),(0,s.jsx)(c.HighlightsSection,{className:"pt-3",story:V}),(0,s.jsx)("div",{className:"h-32"})]})}),(0,s.jsxs)("div",{className:(0,r.cn)("absolute bottom-4 w-full"),children:[(0,s.jsx)(S.QueryBar,{placeholder:e("highlights-story-page-query-bar.input-placeholder","Ask about the story..."),onQuery:et,onFrontPage:!0,isIncognito:U,textAreaClassName:"min-h-14 py-4 my-0 mb-0"}),(0,s.jsx)("div",{className:"absolute -bottom-4 h-14 w-full",children:(0,s.jsx)("div",{className:(0,r.cn)("chat-input-backdrop w-full h-full","bg-gradient-to-b from-surface-base via-surface-base/94 to-surface-base/80")})})]})]})}function R(e){let{children:t}=e,i=(0,u.useRoutingStore)(e=>e.push);return(0,s.jsxs)("div",{className:(0,r.cn)("flex flex-col items-center w-full h-[100vh] overflow-y-auto",x.CHAT_CONTAINER_CLASSES),children:[(0,s.jsx)(m.Button,{variant:"outline",size:"iconMd",rounded:!0,onClick:()=>i({page:"main"}),className:"shrink-0 mt-2 ms-2 self-start sticky top-2",children:(0,s.jsx)(g.ChevronLeft,{className:"size-4"})}),(0,s.jsx)("div",{className:(0,r.cn)("w-full",a.QUERY_BAR_MAX_WIDTH_CLASS),children:t})]})}function B(){let{route:e}=(0,d.useRouting)();return("highlights"===e.page||"trends"===e.page)&&e.storyId?(0,s.jsx)(M,{}):(0,s.jsx)(z,{})}function z(){let{t:e}=(0,i.useTranslation)("chat"),{route:r}=(0,d.useRouting)(),a=(0,n.useHighlightsStore)(e=>e.stories),{isLoading:u,error:g}=(0,h.useLoadHighlights)(),m=(0,o.useLogEvent)();return((0,t.useEffect)(()=>{a.length>0&&m("highlights_shown",String(a.length),{location:"highlights-page:HighlightsAllStoriesView",storyCount:String(a.length)})},[a.length,m]),(0,t.useEffect)(()=>{if(("highlights"===r.page||"trends"===r.page)&&r.storyId){let e=setTimeout(()=>{let e=r.storyId;if(e){let s=document.getElementById(e);s?s.scrollIntoView({behavior:"smooth",block:"start"}):(0,l.logError)("highlights-page:scroll",Error("Story element not found: ".concat(e)))}},100);return()=>clearTimeout(e)}},[r]),u&&0===a.length)?(0,s.jsx)(R,{children:(0,s.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,s.jsx)("p",{className:"text-secondary text-center",children:e("highlights-loading","Loading highlights...")})})}):g?(0,s.jsx)(R,{children:(0,s.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,s.jsx)("p",{className:"text-secondary text-center",children:e("highlights-error","Failed to load highlights. Please try again later.")})})}):0===a.length?(0,s.jsx)(R,{children:(0,s.jsx)("div",{className:"flex flex-col items-center justify-center w-full h-full p-8",children:(0,s.jsx)("p",{className:"text-secondary text-center",children:e("highlights-empty","No highlights available at the moment.")})})}):(0,s.jsx)(R,{children:(0,s.jsx)("div",{className:"flex flex-col gap-10",children:a.map(e=>(0,s.jsx)(c.HighlightsSection,{story:e},e.storyId))})})}}]);
!function(){try{var e="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof globalThis?globalThis:"undefined"!=typeof self?self:{},n=(new e.Error).stack;n&&(e._sentryDebugIds=e._sentryDebugIds||{},e._sentryDebugIds[n]="efcdd85d-26e8-5886-a0b6-ea3830a804c4")}catch(e){}}();
//# debugId=efcdd85d-26e8-5886-a0b6-ea3830a804c4
